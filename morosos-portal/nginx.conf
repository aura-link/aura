server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # Captive portal detection endpoints
    location /generate_204 { return 302 http://$host/; }
    location /gen_204 { return 302 http://$host/; }
    location /hotspot-detect.html { return 302 http://$host/; }
    location /connecttest.txt { return 302 http://$host/; }
    location /ncsi.txt { return 302 http://$host/; }
    location /success.txt { return 302 http://$host/; }

    location / {
        try_files $uri /index.html;
    }
}

server {
    listen 443 ssl;
    server_name _;

    ssl_certificate /etc/nginx/ssl/selfsigned.crt;
    ssl_certificate_key /etc/nginx/ssl/selfsigned.key;

    root /usr/share/nginx/html;
    index index.html;

    # Captive portal detection over HTTPS
    location /generate_204 { return 302 https://$host/; }
    location /gen_204 { return 302 https://$host/; }
    location /hotspot-detect.html { return 302 https://$host/; }
    location /connecttest.txt { return 302 https://$host/; }
    location /ncsi.txt { return 302 https://$host/; }
    location /success.txt { return 302 https://$host/; }

    location / {
        try_files $uri /index.html;
    }
}
